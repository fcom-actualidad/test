(this["webpackJsonpfcom-quiz-app"]=this["webpackJsonpfcom-quiz-app"]||[]).push([[0],{107:function(e,t){},109:function(e,t){},121:function(e,t,s){"use strict";s.r(t);var r=s(1),a=s.n(r),c=s(62),o=s.n(c),n=(s(68),s(0));var i=function(e){let{handleSubmit:t,setWithTimer:s,loading:r,loadingQuestions:a,quizInProgress:c,isShown:o,togglePassword:i,currentPlayer:l,handleLogout:d,handleProfile:j}=e;return Object(n.jsxs)("header",{children:[l&&Object(n.jsxs)("div",{children:[Object(n.jsxs)("h1",{children:["Hola, ",l.name]}),Object(n.jsxs)("div",{className:"buttons-section",children:[Object(n.jsx)("button",{className:"btn bg-green",type:"button",onClick:j,children:"Mis Puntajes"}),Object(n.jsx)("button",{className:"btn bg-red",type:"button",onClick:d,children:"Salir"})]})]}),!l&&Object(n.jsxs)("form",{onSubmit:t,children:[Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"email",children:"Email"}),Object(n.jsx)("input",{type:"text",id:"email",defaultValue:"email",disabled:r||c})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"password",children:"Contrase\xf1a"}),Object(n.jsx)("input",{id:"password",type:o?"text":"password",defaultValue:"contrase\xf1a",disabled:r||c}),Object(n.jsxs)("div",{className:"checkbox-container",children:[Object(n.jsx)("label",{htmlFor:"checkbox",children:"Mostrar "}),Object(n.jsx)("input",{id:"checkbox",type:"checkbox",checked:o,onChange:i})]})]}),Object(n.jsx)("div",{className:"form-group",children:Object(n.jsx)("button",{className:"btn",type:"submit",disabled:r||c,children:r?"Loading...":c?"En juego":"Ingresar"})})]})]})};var l=function(e){let{questionNum:t,totalQuestions:s,percentage:a}=e;const c=Object(r.useRef)();return Object(r.useEffect)((()=>{c.current.style.setProperty("--progress",a)}),[a]),Object(n.jsxs)("div",{className:"progress-conatiner",children:[Object(n.jsxs)("div",{className:"progress-text",children:["Pregunta ",t," de ",s]}),Object(n.jsx)("div",{ref:c,className:"progress-bar"})]})};var d=function(e){let{score:t,timer:s,withTimer:r}=e;return Object(n.jsxs)("div",{className:"score-timer-container",children:[r&&Object(n.jsxs)("div",{className:"score-timer-border",children:[Object(n.jsx)("div",{className:"score-timer-text",children:"Timer"}),Object(n.jsx)("div",{className:"score-timer-number",children:s})]}),Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"score-timer-text",children:"Correctas"}),Object(n.jsx)("div",{className:"score-timer-number",children:t})]})]})};var j=function(e){let{question:t,handleAnswers:s,setTimer:a,withTimer:c,lastQuestion:o,gameEnded:i,timer:l}=e;const[d,j]=Object(r.useState)(!1),[u,m]=Object(r.useState)(""),b=Object(r.useRef)();return b.current=()=>{m(t.answer),j(!0),s({questionId:t._id,option:null,time:t.time-l,score:t.score+l,correct:!1})},Object(r.useEffect)((()=>{m(""),j(!1)}),[t]),Object(r.useEffect)((()=>{if(!c)return;let e=t.time;const s=setInterval((()=>(a(e),e--,d?(a(0),clearInterval(s)):e<0&&!d?(a(0),b.current(),console.log("timeout"),clearInterval(s)):void 0)),1e3);return()=>clearInterval(s)}),[c,t,a,d]),Object(n.jsxs)("article",{className:"question",children:[Object(n.jsx)("h2",{children:t.question}),Object(n.jsx)("ul",{children:t.options.map(((e,r)=>d?Object(n.jsx)("li",{className:"answered\n\t\t\t\t\t\t\t\t".concat(e===u?e.correct?"isRight":"isWrong":u!==t.answer&&e.correct?"isRight":""," \n\t\t\t\t\t\t\t"),children:e.content},e._id):Object(n.jsx)("li",{onClick:()=>(e=>{m(e),j(!0),s({questionId:t._id,option:e._id,time:t.time-l,score:t.score+l,correct:e.correct})})(e),children:e.content},e._id)))}),d&&!o&&Object(n.jsxs)("p",{children:["Cargando siguiente pregunta... ",Object(n.jsx)("span",{className:"loader",children:"\u23f3"})]}),d&&o&&Object(n.jsx)("p",{children:"\xa1Terminaste! \ud83c\udfc1"}),d&&o&&!i&&Object(n.jsxs)("p",{children:["Calculando nota... ",Object(n.jsx)("span",{className:"loader",children:"\u23f3"})]})]})},u=s(6),m=s.n(u),b=s(2),h=s(63);const g="https://engine-fcom.onrender.com/api";var O=function(e){let{setError:t}=e;const[s,a]=Object(r.useState)(!1),[c,o]=Object(r.useState)(null),[i,l]=Object(r.useState)("");return Object(r.useEffect)((()=>{(async()=>{a(!0);try{const t=await(async()=>{const e=b.ReactSession.get("gameName"),t=b.ReactSession.get("email");try{const s=await m()({method:"GET",url:g+"/game/scores",params:{gameName:e,email:t},headers:{Authorization:"Bearer "+b.ReactSession.get("token")}});return s.length>0?{code:400,errors:"\ud83d\ude41 No logramos encontrar los puntajes a\xfan!"}:{code:200,message:s,user:t}}catch(s){return console.log(s),{code:500,errors:"\ud83d\ude41 Ocurri\xf3 un error y no logramos recuperar los puntajes."}}})(),c=t.message.data;if(!c.length>0)return a(!1);const n=(r=c,Object.values(r).sort(((e,t)=>t.finalScore-e.finalScore))),i=(e=n,s=t.user,e.find((e=>e.email===s)));l(i),o(n)}catch(c){console.log(c),t("\ud83d\ude41 Error loading leaderboard.")}var e,s,r;a(!1)})()}),[t]),Object(n.jsxs)("div",{className:"leaderboard",children:[i&&Object(n.jsxs)("div",{className:"leaderboard-group gold",children:[Object(n.jsx)("h3",{children:"Tu puntaje Obtenido"}),Object(n.jsxs)("span",{children:[i.email," - ",i.finalScore]}),Object(n.jsxs)("h5",{children:["Nota: ",(i.grade/10).toFixed(1)]})]}),Object(n.jsx)("h1",{children:"RANKING \ud83c\udfc6"}),c&&Object(n.jsxs)("div",{className:"leaderboard-group",children:[Object(n.jsx)("h3",{children:"Top 10"}),Object(n.jsx)("ul",{children:c.filter(((e,t)=>t<10)).map(((e,t)=>Object(n.jsxs)("li",{children:[0===t&&"\ud83e\udd47 ",1===t&&"\ud83e\udd48 ",2===t&&"\ud83e\udd49 ",e.email," - ",e.finalScore]},t)))})]},""),s&&Object(n.jsx)("h3",{children:"Cargando ranking..."}),!c&&!s&&Object(n.jsx)("h3",{children:"\xa1A\xfan sin puntajes!"})]})};var x=function(e){let{category:t,score:s,setError:a,resetGame:c}=e;const[o,i]=Object(r.useState)("");return Object(n.jsx)(r.Fragment,{children:Object(n.jsx)("h3",{children:"Revisa tu calificaci\xf3n \ud83d\ude4c"})})};var p=function(e){let{user:t,setError:s,resetGame:a}=e;const[c,o]=Object(r.useState)(!1),[i,l]=Object(r.useState)(null);return Object(r.useEffect)((()=>{(async()=>{o(!0);try{const e=await(async()=>{const e=b.ReactSession.get("email");try{const t=await m()({method:"GET",url:g+"/game/grades",params:{email:e},headers:{Authorization:"Bearer "+b.ReactSession.get("token")}});return t.length>0?{code:400,errors:"\ud83d\ude41 No logramos encontrar los puntajes a\xfan!"}:{code:200,message:t,user:e}}catch(t){return console.log(t),{code:500,errors:"\ud83d\ude41 Ocurri\xf3 un error y no logramos recuperar los puntajes."}}})();let t=[];t=e.message.data,l(t)}catch(e){console.log(e),s("\ud83d\ude41 Error.")}o(!1)})()}),[s]),Object(n.jsxs)("div",{className:"leaderboard",children:[Object(n.jsx)("h3",{children:"Revisa tus calificaciones \ud83d\udda5"}),i&&Object(n.jsx)("div",{className:"leaderboard-group",children:Object(n.jsxs)("table",{children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:"Fecha"}),Object(n.jsx)("th",{children:"Test"}),Object(n.jsx)("th",{children:"Nota"}),Object(n.jsx)("th",{children:"Puntaje"})]})}),Object(n.jsx)("tbody",{children:i.map(((e,t)=>Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:new Date(e.updated_at).toLocaleDateString()}),Object(n.jsx)("td",{children:e.gameName}),Object(n.jsx)("td",{children:(e.grade/10).toFixed(1)}),Object(n.jsx)("td",{children:e.finalScore})]},t)))})]})}),c&&Object(n.jsx)("h3",{children:"Cargando calificaciones..."}),!i&&!c&&Object(n.jsx)("h3",{children:"\xa1A\xfan sin puntajes!"})]})},f=s(39);b.ReactSession.setStoreType("localStorage");let S={version:f.a.CAS_VERSION_3_0},v=new f.b("sso.uc.cl",S);var N=function(){let e=null;void 0!==b.ReactSession.get("name")&&(e={name:b.ReactSession.get("name"),email:b.ReactSession.get("email")});const[t,s]=Object(r.useState)(e),[a,c]=Object(r.useState)(!1),[o,u]=Object(r.useState)(!1),[f,S]=Object(r.useState)(!1),[N,y]=Object(r.useState)(!1),[w,E]=Object(r.useState)(!1),[R,T]=Object(r.useState)(!0),[k,I]=Object(r.useState)(0),[C,q]=Object(r.useState)([]),[P,A]=Object(r.useState)("General Knowledge"),[F,G]=Object(r.useState)(null),[_,D]=Object(r.useState)(0),[z,B]=Object(r.useState)(0),[L,M]=Object(r.useState)([]),[Q,V]=Object(r.useState)(0),[J,K]=Object(r.useState)(!1),[W,H]=Object(r.useState)(!1),[U,X]=Object(r.useState)(!1),Y=()=>{I(0),q([]),A("General Knowledge"),G(null),D(0),B(0),M([]),V(0),K(!1),H(!1)},Z=Object(r.useRef)();return Z.current=()=>{let e=Q;for(const t of L)null!==t&&t.isCorrectAnswer&&(e+=1);V(e),_<z&&(G(C[_]),D(_+1)),_===z&&H(!0)},Object(r.useEffect)((()=>{G(C[0]),D(1)}),[C]),Object(r.useEffect)((()=>{if(!L.length)return;const e=setTimeout((()=>Z.current()),1500);return()=>clearTimeout(e)}),[L]),Object(r.useEffect)((()=>{const e=setTimeout((()=>c(!1)),5e3);return()=>clearTimeout(e)}),[a]),Object(n.jsxs)(r.Fragment,{children:[Object(n.jsx)("div",{className:"game-title",children:Object(n.jsx)("a",{onClick:async e=>{e.preventDefault(),X(!1)},href:"/",children:Object(n.jsx)("h1",{children:" \ud83d\ude80 TEST DE ACTUALIDAD"})})}),Object(n.jsx)(i,{handleSubmit:async e=>{e.preventDefault(),y(!0),Y();const t=e.target.email.value,r=e.target.password.value;v.auth().then((e=>{console.log(e),console.log("TEST"),console.log(e.ticket),console.log(e.user)})).catch((e=>{console.error(e)}));const o={code:300,data:{name:"Juanito",email:t}};200===o.code?(s(o.data),await(async e=>{try{const t=await m()({method:"POST",url:g+"/auth",data:e});return console.log("aut",t),201!==t.status?{code:400,errors:"\ud83d\ude41 No logramos iniciar sesi\xf3n!",data:t.data}:(console.log(t),b.ReactSession.set("token",t.data.token),{code:200,data:t.data})}catch(a){return console.log(a),{code:500,errors:"\ud83d\ude41 Ocurri\xf3 un error y no logramos iniciar sesi\xf3n. "}}})({email:t,password:r}),console.log("logueado!")):c(o.errors),y(!1)},setWithTimer:T,loading:N,loadingQuestions:w,quizInProgress:J,isShown:o,togglePassword:()=>{u((e=>!e))},currentPlayer:t,handleLogout:async e=>{e.preventDefault(),Y(),b.ReactSession.remove("userName"),b.ReactSession.remove("name"),b.ReactSession.remove("email"),b.ReactSession.remove("gameName"),b.ReactSession.remove("gameId"),b.ReactSession.remove("token"),X(!1),s(null)},handleProfile:async e=>{e.preventDefault(),X(!0)}}),Object(n.jsxs)("div",{className:"container",children:[a&&Object(n.jsx)("div",{className:"error-message",children:a}),N&&Object(n.jsxs)("p",{children:["Cargando... ",Object(n.jsx)("span",{className:"loader",children:"\u23f3"})]}),t&&U&&(!J||W)&&Object(n.jsx)(r.Fragment,{children:Object(n.jsx)(p,{user:t,setError:c})}),t&&!U&&!J&&!f&&Object(n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),y(!0),Y();const t=e.target.gameCode.value,s=await(async e=>{try{const t=await m()({method:"GET",url:g+"/game/checkGame",params:{gameName:e},headers:{Authorization:"Bearer "+b.ReactSession.get("token")}});return console.log("g",t),200!==t.status?{code:400,errors:"\ud83d\ude41 No logramos encontrar el juego!"}:(b.ReactSession.set("gameName",t.data.gameName),b.ReactSession.set("gameId",t.data._id),{code:200,data:t.data})}catch(a){return console.log(a),{code:404,errors:"\ud83d\ude41 No logramos encontrar el juego!"}}})(t);if(200===s.code){S(!0);let e=await(async e=>{try{const t=await m()({method:"GET",url:g+"/game/questions",params:{gameId:e},headers:{Authorization:"Bearer "+b.ReactSession.get("token")}});if(200!==t.status)return;return 405===t.data.code?{code:405,data:t.data}:(t.data.forEach((e=>{e.options.forEach((e=>{const t=Object(h.a)(e.correct);e.correct=t}))})),{code:200,data:t.data})}catch(a){return console.log(a),{code:404,errors:"\ud83d\ude41 No logramos encontrar el juego!"}}})(s.data._id);200===e.code?(e.data=e.data.sort((()=>Math.random()-.5)),e.data.forEach((e=>{e.options=e.options.sort((()=>Math.random()-.5))})),B(e.data.length),q(e.data),K(!0)):405===e.code?H(!0):c(e.errors)}else c(s.errors);y(!1)},children:[Object(n.jsx)("div",{children:Object(n.jsx)("p",{children:"Para responder el test debes indicar primero el c\xf3digo espec\xedfico de la sesi\xf3n que te corresponde"})}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"gameCode",children:"C\xf3digo de juego"}),Object(n.jsx)("input",{type:"text",id:"gameCode",defaultValue:"secreto"})]}),Object(n.jsx)("div",{className:"form-group",children:Object(n.jsx)("button",{className:"btn",type:"submit",disabled:N||J,children:N?"Loading...":J?"En juego":"Responder"})})]}),F&&!W&&Object(n.jsxs)(r.Fragment,{children:[Object(n.jsxs)("div",{className:"flex-between",children:[Object(n.jsx)(l,{questionNum:_,totalQuestions:z,percentage:($=_,ee=z,0===$||0===ee?0:Math.floor(100*$/ee))}),Object(n.jsx)(d,{question:F,score:Q,withTimer:R,timer:k})]}),Object(n.jsx)(j,{question:F,handleAnswers:e=>{e&&(console.log("Post answer:",e,e.questionId,e.option,e.time),(async(e,t,s)=>{const r=b.ReactSession.get("gameId");try{const a=await m()({method:"POST",url:g+"/game/answer",data:{answerId:t,gameId:r,time:s,questionId:e},headers:{Authorization:"Bearer "+b.ReactSession.get("token")}});if(200!==a.status)return;return{code:200,data:a.data}}catch(a){return console.log(a),{code:404,errors:"\ud83d\ude41 Error al guardar la respuesta!"}}})(e.questionId,e.option,e.time),M((t=>[...t,e])),V(Q+(e.correct?1:0)))},lastQuestion:_===z,gameEnded:W,setTimer:I,withTimer:R,timer:k})]}),W&&!U&&Object(n.jsx)(x,{category:P,score:Q,setError:c,resetGame:Y}),W&&!U&&Object(n.jsx)(O,{setError:c})]})]});var $,ee};o.a.render(Object(n.jsx)(a.a.StrictMode,{children:Object(n.jsx)(N,{})}),document.getElementById("root"))},68:function(e,t,s){}},[[121,1,2]]]);
//# sourceMappingURL=main.fa5d1ab5.chunk.js.map